<!DOCTYPE html>
<html lang="es" xmlns:th="https://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Document</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .centrado {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .section {
            border: 1px solid black;

        }

        .but-question {
            visibility: collapse;
        }
    </style>
</head>

<body onload="onLoadCreate()">
    <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Nombre de la encuesta</label>
        <input type="email" class="form-control" id="head" placeholder="Título de la encuesta">
    </div>
    <div class="mb-3">
        <label for="exampleFormControlTextarea1" class="form-label">Example textarea</label>
        <textarea class="form-control" id="description" rows="3"></textarea>
    </div>


    <label for="categories">categoria</label>
    <select id="categories" class="form-select w-25" aria-label="Default select example">

    </select>

    <div id="content" class="content centrado p-2">
        <div id="section-1" class="centrado p-5 section" onclick="buttonVisible()">
            <div id="content-section-1" class="centrado">
                <input id="header-chapter-1" type="text" class="section-1" value="Capítulo 1">
            </div>

            <button id="but-section-1" class=" but-question section-1 " onclick="createQuestion()">Nueva
                pregunta</button>

        </div>


    </div>

    <div id="new-buttons">
        <button onclick="createChapter()">Nuevo cap</button>

    </div>


    <button id="regist-button">Registrar Encuesta</button>


    <script src="../scripts/surveyGenerator.js">   </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <script>
        alert("llegue a mi funciones")

        /*         const getSurveyById = async (id) => {
                    try {
                        const response = await fetch(`http://localhost:8090/survey/findOne/${id}`);
        
                        if (!response.ok) {
                            throw new Error('Error al obtener la encuesta');
                        }
                        const survey = await response.json();
                        console.log(survey);
                    } catch (error) {
                        console.error(error);
                    }
                };
                
                // Ejemplo de uso:
                getSurveyById(5); */

        function fetchSurveyById(id) {
            const url = `http://localhost:8090/survey/findOne/${id}`;

            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! Status: ${response.status}, Message: ${text}`);
                        });
                    }
                    return response.text();  // Cambiado a `response.text()` para manejar respuestas de texto
                })
                .then(data => {
                    console.log("Datos recibidos:", data);  // Aquí puedes manejar el string recibido
                    const obj = JSON.parse(data);
                    console.log(obj);
                })
                .catch(error => {
                    console.error("Error al buscar los datos:", error);
                    console.log("Error al buscar los datos.");  // Notifica al usuario en caso de error
                });
        }

        // Ejemplo de uso:
        fetchSurveyById(15);


        // peticion post 

        function createSurvey(surveyData) {
            const urlPost = 'http://localhost:8090/survey/createSurvey';

            fetch(urlPost, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(surveyData)
            })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! Status: ${response.status}, Message: ${text}`);
                        });
                    }
                    return response.text();  // O usar response.json() si la respuesta es JSON
                })
                .then(data => {
                    console.log('Encuesta creada:', data);
                    const createdSurvey = JSON.parse(data);
                    console.log(createdSurvey);
                })
                .catch(error => {
                    console.error('Error al crear la encuesta:', error);
                });
        }

        // Ejemplo de uso:
        const newSurveyData = {
            name: 'Encuesta de Satisfacción',
            description: 'Encuesta para evaluar la satisfacción del cliente'
        };
        createSurvey(newSurveyData);

        // PETICION PUT
        function updateSurvey(id, updatedSurveyData) {
            const urlPut = `http://localhost:8090/survey/updateSurvey/${id}`;

            fetch(urlPut, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedSurveyData)
            })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! Status: ${response.status}, Message: ${text}`);
                        });
                    }
                    return response.text();  // O usar response.json() si la respuesta es JSON
                })
                .then(data => {
                    console.log('Encuesta actualizada:', data);
                    const updatedSurvey = JSON.parse(data);
                    console.log(updatedSurvey);
                })
                .catch(error => {
                    console.error('Error al actualizar la encuesta:', error);
                });
        }

        // Ejemplo de uso:
        const updatedSurveyData = {
            name: 'Encuesta de Satisfacción Actualizada',
            description: 'Descripción actualizada de la encuesta'
        };
        updateSurvey(15, updatedSurveyData);

        // PETECION DELETE
        function deleteSurvey(id) {
            const urlDelete = `http://localhost:8090/survey/deleteOne/${id}`;

            fetch(urlDelete, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! Status: ${response.status}, Message: ${text}`);
                        });
                    }
                    console.log('Encuesta eliminada correctamente');
                })

                .catch(error => {
                    console.error('Error al eliminar la encuesta:', error);
                });
        }

        // Ejemplo de uso:
        deleteSurvey(1);



        // PETICION LIST ALL

        function surveyAll() {
            const url = `http://localhost:8090/survey/findAll`;

            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! Status: ${response.status}, Message: ${text}`);
                        });
                    }
                    return response.text();  // Cambiado a `response.text()` para manejar respuestas de texto
                })
                .then(data => {
                    console.log("Datos recibidos:", data);  // Aquí puedes manejar el string recibido
                    const obj = JSON.parse(data);
                    console.log(obj);
                })
                .catch(error => {
                    console.error("Error al buscar los datos:", error);
                    console.log("Error al buscar los datos.");  // Notifica al usuario en caso de error
                });
        }

        // Ejemplo de uso:
        surveyAll();


    </script>
</body>

</html>